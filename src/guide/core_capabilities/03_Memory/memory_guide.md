# LangGraph 内存功能指南

## 概述

AI 应用程序需要内存来在多次交互之间共享上下文。在 LangGraph 中，您可以添加两种类型的内存：

1. **短期内存** - 作为代理状态的一部分，实现多轮对话
2. **长期内存** - 跨会话存储用户特定或应用程序级别的数据

## 短期内存 (Short-term Memory)

### 基本概念
短期内存（线程级持久化）使代理能够跟踪多轮对话。

### 核心组件
- **InMemorySaver**: 内存中的检查点保存器
- **StateGraph**: 状态图，用于构建工作流
- **checkpointer**: 检查点管理器

### 使用场景
1. **开发环境**: 使用 `InMemorySaver`
2. **生产环境**: 使用数据库支持的检查点器（如 PostgreSQL、MongoDB）

### 主要功能
- 多轮对话支持
- 状态持久化
- 线程管理

## 长期内存 (Long-term Memory)

### 基本概念
长期内存用于跨会话存储数据，支持更复杂的记忆管理。

### 核心功能
1. **读取长期内存**: 在工具中访问存储的记忆
2. **写入长期内存**: 从工具中保存新的记忆
3. **语义搜索**: 基于内容相似性搜索记忆

### 使用场景
- 用户偏好存储
- 历史交互记录
- 知识库构建

## 内存管理功能

### 短期内存管理
1. **修剪消息**: 控制消息历史长度
2. **删除消息**: 移除特定消息
3. **总结消息**: 将长对话压缩为摘要
4. **管理检查点**: 查看、删除检查点

### 检查点管理
- **查看线程状态**: 获取当前检查点
- **查看历史**: 获取线程的所有检查点
- **删除检查点**: 清理特定线程的所有检查点

## 预构建内存工具

### LangMem
LangMem 是 LangChain 维护的库，提供管理代理长期记忆的工具。

## 最佳实践

### 开发阶段
- 使用 `InMemorySaver` 进行快速原型开发
- 利用检查点功能进行调试

### 生产部署
- 使用数据库支持的检查点器
- 实现适当的内存清理策略
- 考虑性能和存储成本

### 内存策略
- 根据应用需求选择合适的记忆类型
- 定期清理过期的记忆数据
- 实现记忆压缩和摘要功能

## 技术要点

### 检查点器类型
1. **InMemorySaver**: 内存存储，适合开发
2. **PostgresSaver**: PostgreSQL 存储，适合生产
3. **MongoDBSaver**: MongoDB 存储，适合文档型数据

### 配置参数
- `thread_id`: 线程标识符
- `checkpoint_ns`: 检查点命名空间
- `checkpoint_id`: 检查点标识符

### 状态管理
- 使用 `MessagesState` 管理消息状态
- 支持流式处理
- 异步操作支持
